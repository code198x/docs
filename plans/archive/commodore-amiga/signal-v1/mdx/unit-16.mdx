---
title: "Polish and System Restore"
description: "Final touches, proper system restoration, and the complete game."
pubDate: 2026-01-04
game: 1
gameName: "Hop"
unit: 16
totalUnits: 16
system: "Commodore Amiga"
tags: ["assembly", "68000", "polish", "release", "system-restore"]
nextLesson: "/commodore-amiga"
layout: "../../../../layouts/UnitLayout.astro"
---

import CodeFromFile from "@components/CodeFromFile.astro";

import InlineNote from "../../../../components/units/InlineNote.astro";

*Need to catch up? Check out [Unit 15: Time Limit](/commodore-amiga/game-01-signal/unit-15).*

## What You're Building

This final unit adds the finishing touches to make Hop a complete, polished game:

- Proper system state restoration when exiting
- Version number display on the title screen
- Palette transitions between game states
- Final code organisation and comments
- A releasable executable

When you're done, you'll have a complete Frogger clone that takes over the Amiga hardware, plays smoothly, and returns cleanly to the operating system.

## System Restoration

Throughout this course, we've been taking over the Amiga hardware directly. Before our program exits, we must restore everything we changed. Failing to do so will crash the system or leave it in an unusable state.

### What We Need to Restore

1. **Interrupt and DMA state** - The original INTENA, INTREQ, and DMACON values
2. **Copper list pointer** - The system's original copper list
3. **Display registers** - BPLCON0, DIWSTRT, DIWSTOP, etc.
4. **CIA registers** - Any timer or port settings we changed

### Saving System State

At startup, we save the values we'll need to restore:

<CodeFromFile src="commodore-amiga/game-01-signal/unit-16/snippets/01-system-restoration.asm" lang="asm" />

### Restoring System State

When exiting (via a quit key or completing all levels), we restore everything:

<CodeFromFile src="commodore-amiga/game-01-signal/unit-16/snippets/02-system-restoration.asm" lang="asm" />

<InlineNote>
In a production game, you'd use exec.library's Forbid/Permit and graphics.library's LoadView/WaitTOF to properly save and restore the display. Our simplified approach works for learning but a commercial release would need more robust system handling.
</InlineNote>

## Exit Handling

We add an escape key check to allow clean exit:

<CodeFromFile src="commodore-amiga/game-01-signal/unit-16/snippets/03-exit-handling.asm" lang="asm" />

## Version Display

A version string on the title screen helps identify builds:

<CodeFromFile src="commodore-amiga/game-01-signal/unit-16/snippets/04-version-display.asm" lang="asm" />

## Palette Refinement

Different palettes for different game states make transitions clearer:

<CodeFromFile src="commodore-amiga/game-01-signal/unit-16/snippets/05-palette-refinement.asm" lang="asm" />

## Final Game Flow

The complete game flow ties everything together:

```
                    ┌─────────────┐
                    │   STARTUP   │
                    │ Save state  │
                    │ Init system │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
            ┌──────►│   TITLE     │◄─────────┐
            │       │ Show title  │          │
            │       │ High scores │          │
            │       └──────┬──────┘          │
            │              │ Fire            │
            │       ┌──────▼──────┐          │
            │       │   PLAYING   │          │
            │       │ Game loop   │          │
            │       └──────┬──────┘          │
            │              │                 │
            │    ┌─────────┼─────────┐       │
            │    │         │         │       │
            │ Lives=0   Level++   Escape     │
            │    │         │         │       │
            │    ▼         │         ▼       │
            │ ┌──────┐     │    ┌────────┐   │
            │ │ENTRY?│     │    │ QUIT   │   │
            │ │Score │     │    │Restore │   │
            │ │check │     │    │ state  │   │
            │ └───┬──┘     │    └────────┘   │
            │     │        │                 │
            └─────┴────────┴─────────────────┘
```

## Build and Package

Assemble the final executable:

```bash
vasmm68k_mot -Fhunkexe -o hop -nosym hop.asm
```

To create a bootable ADF disk image, you can use tools like `xdftool` or ADFOpus to:

1. Create a blank 880KB ADF
2. Copy the `hop` executable to the disk
3. Create a startup-sequence that runs `hop`

## What You've Built

Over these 16 units, you've created a complete Frogger clone featuring:

- **Direct hardware control** - Copper lists, bitplane graphics, custom chip registers
- **Smooth animation** - 50fps gameplay with vsync timing
- **Complete game mechanics** - Movement, hazards, collision, scoring
- **Audio feedback** - Sound effects for actions and events
- **Multiple game states** - Title, playing, game over, name entry
- **Persistent high scores** - Name entry with alphabetic input
- **Progressive difficulty** - Faster hazards on higher levels
- **Time pressure** - Countdown timer with visual feedback
- **Polish** - Clean transitions and proper system handling

## What You've Learnt

Throughout this course, you've mastered:

- **68000 Assembly** - Registers, addressing modes, instruction timing
- **Amiga Hardware** - Custom chips, copper lists, bitplane graphics
- **Game Architecture** - State machines, game loops, entity management
- **Graphics Programming** - Sprites simulation via blitting, tile-based backgrounds
- **Audio Programming** - Sample playback via Paula
- **Input Handling** - Joystick and keyboard via CIA chips
- **Optimisation** - Fixed-point maths, lookup tables, efficient loops

## Next Steps

From here, you could:

- Add more levels with different layouts
- Implement two-player alternating mode
- Add more hazard types (snakes, alligators)
- Create a proper title screen graphic
- Add music using a tracker module player
- Port to other Amiga models (AGA support)

## The Complete Code

Here's the final, complete `hop.asm` with all features:

<CodeFromFile src="commodore-amiga/game-01-signal/unit-16/hop.asm" lang="asm" />

## Congratulations!

You've completed the entire Hop course. You now have a solid foundation in 68000 assembly programming and Amiga hardware. The skills you've learnt here - register manipulation, memory management, hardware timing, and low-level graphics - form the basis for any classic Amiga game development.

The complete source code is available in the code repository. From here, experiment, modify, and create your own games!
