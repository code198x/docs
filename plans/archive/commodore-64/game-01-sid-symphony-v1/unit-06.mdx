---
title: "Three Voices"
description: "Expand to all three tracks with all three SID voices. Three keys, three lanes, three sounds."
pubDate: 2025-11-25
game: 1
gameName: "SID Symphony"
unit: 6
totalUnits: 16
system: "Commodore 64"
tags: ["assembly", "6510", "sid", "multi-voice", "keyboard-matrix"]
prevLesson: "/commodore-64/assembly/game-01-sid-symphony/unit-05"
nextLesson: "/commodore-64/assembly/game-01-sid-symphony/unit-07"
layout: "../../../../layouts/UnitLayout.astro"
---

import CodeFromFile from "@components/CodeFromFile.astro";

import InlineNote from "../../../../components/units/InlineNote.astro";

*Need to catch up? Check out [Unit 5: The Crowd](/commodore-64/game-01-sid-symphony/unit-05).*

## What You're Building

One track. One key. One voice. But this is SID *Symphony* — we need harmony.

By the end of this unit, you'll have:

- All three tracks active
- Three keys (X, C, V) for the three tracks
- Three SID voices playing a C major chord
- Notes spawning across all tracks in rotation
- Track-specific hit detection and feedback

It's a real rhythm game now. Your fingers are moving, the SID is singing harmonies.

## Three Tracks, Three Keys

| Track | Row | Key | SID Voice | Note |
|-------|-----|-----|-----------|------|
| 0 (top) | 10 | X | Voice 1 | C4 |
| 1 (middle) | 12 | C | Voice 2 | E4 |
| 2 (bottom) | 14 | V | Voice 3 | G4 |

Why X, C, V? They're adjacent on the bottom row of the keyboard. Three fingers, three keys, natural hand position. It's the same pattern rhythm games have used for decades.

## Reading Three Keys

The C64 keyboard is a matrix. Each key sits at the intersection of a row and column. To read a key, we select its column (by writing to CIA1_PORTA) and check its row (by reading CIA1_PORTB):

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/01-reading-three-keys.asm" lang="asm" />

<InlineNote>
The keyboard matrix is documented in every C64 reference. Each key has a column (0-7) and row (0-7). Write a 0 bit to select a column in CIA1_PORTA, then read the rows from CIA1_PORTB. A 0 bit means the key is pressed.
</InlineNote>

## Three SID Voices

The SID has three identical voices, each with its own registers at 7-byte intervals:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/02-three-sid-voices.asm" lang="asm" />

We configure each voice with a different pitch to form a C major chord:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/03-three-sid-voices.asm" lang="asm" />

When you hit all three notes together, the chord rings out. That's the "symphony" moment.

## Note Data with Tracks

Notes now need to know which track they belong to:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/04-note-data-with-tracks.asm" lang="asm" />

Why 12 slots? With three tracks spawning notes, we might have 4 per track visible at once. This gives us plenty of headroom.

## Track-Specific Hit Detection

When X is pressed, only check notes on track 0. When C is pressed, check track 1. When V is pressed, check track 2:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/05-track-specific-hit-detection.asm" lang="asm" />

Pressing the wrong key for a note does nothing — you can't hit a track 1 note with the X key.

## Drawing with Track Lookup

Drawing now uses lookup tables for track positions:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/06-drawing-with-track-lookup.asm" lang="asm" />

When drawing a note, we look up the base address from the track number and add the X position using a zero page pointer:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/07-drawing-with-track-lookup.asm" lang="asm" />

## Round-Robin Spawning

Notes spawn on rotating tracks:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/snippets/08-round-robin-spawning.asm" lang="asm" />

This creates a predictable pattern: track 0, track 1, track 2, repeat. In Unit 7, song data will specify exactly which track each note spawns on.

## Build It. Run It.

Assemble and run:

```bash
acme -o symphony.prg symphony.asm
x64sc symphony.prg
```

Watch notes appear on all three tracks. Press X for the top track, C for the middle, V for the bottom. Each hit plays a different note — C, E, or G. Hit all three at once and hear the chord.

## What You've Learnt

- **Keyboard matrix**: How to read specific keys by row and column
- **SID voice architecture**: Three independent voices with identical registers
- **Parallel arrays**: Storing related data (note_x, note_track) in matching arrays
- **Lookup tables**: Using arrays to convert indices to addresses
- **Indirect addressing**: Using zero page pointers for calculated addresses

## Next Unit

Notes spawn in a fixed rotation: track 0, 1, 2, repeat. That's predictable — not musical. Real rhythm games have authored note patterns.

In [Unit 7: Song Data](/commodore-64/game-01-sid-symphony/unit-07), we replace the timer-based spawning with song data. Each note has a timestamp and a track. The same engine can play any song.

## The Complete Code

Here's the complete `symphony.asm` including all features from Units 1-6:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-06/symphony.asm" lang="asm" />

