---
title: "Hit Detection"
description: "The heart of rhythm gaming. Detect when key presses match notes, play sounds on hits, and start tracking score."
pubDate: 2026-01-09
game: 1
gameName: "SID Symphony"
unit: 12
totalUnits: 16
system: "Commodore 64"
tags: ["assembly", "6510", "hit-detection", "scoring", "bcd", "sid"]
prevLesson: "/commodore-64/assembly/game-01-sid-symphony/unit-11"
nextLesson: "/commodore-64/assembly/game-01-sid-symphony/unit-13"
layout: "../../../../layouts/UnitLayout.astro"
---

import CodeFromFile from "@components/CodeFromFile.astro";
import InlineNote from "../../../../components/units/InlineNote.astro";

*Need to catch up? Check out [Unit 11: Keyboard Input](/commodore-64/assembly/game-01-sid-symphony/unit-11).*

## What You're Building

Notes flow. Keys work. But they're disconnected — pressing X when a cyan note sits in the hit zone does nothing special.

By the end of this unit, you'll have:

- Hit detection: matching key presses to notes in the hit zone
- Sound on hit: the SID plays the note you successfully hit
- Scoring: points accumulate with each successful hit
- Visual feedback: notes disappear when hit

This is where it becomes a *game*.

## The Hit Detection Algorithm

A hit requires three conditions:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-12/snippets/01-check-hit.asm" />

The algorithm:
1. Loop through all note slots
2. Skip inactive notes
3. Skip notes on wrong track
4. Skip notes outside hit zone (columns 3-6)
5. If all conditions pass: HIT!

We use the carry flag to return results: set = hit found, clear = no hit. This lets the caller branch efficiently with `bcc` (no hit) or `bcs` (hit).

<InlineNote>
Why search all 8 notes? There might be multiple notes on the same track. We hit the first one found in the hit zone. A more sophisticated system would find the *closest* note, but for our simple song, first-found works.
</InlineNote>

## Playing the Hit Sound

When you hit a note, the SID should sing:

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-12/snippets/02-play-hit-note.asm" />

Each track uses its own SID voice:
- Track 1 (X key) → Voice 1
- Track 2 (C key) → Voice 2
- Track 3 (V key) → Voice 3

This means hitting notes on different tracks produces a chord — multiple voices singing simultaneously. Hit all three tracks together and you hear harmony.

## BCD Scoring

Displaying scores is easier with BCD (Binary Coded Decimal):

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-12/snippets/03-scoring.asm" />

In BCD, each nibble (4 bits) holds a single decimal digit (0-9). The value `$50` literally means "50" — the 5 is in the high nibble, 0 in the low.

The 6502's decimal mode (`sed`) makes addition automatically carry at 10 instead of 16. Add `$10` (ten points) repeatedly and you get 10, 20, 30... with proper decimal carries.

<InlineNote>
Don't forget `cld` (clear decimal mode) when done! Leaving decimal mode set causes mysterious bugs — other code expects binary arithmetic.
</InlineNote>

## The Complete Flow

When a key is newly pressed:

```asm
handle_input:
                lda key_x_pressed
                beq .no_x
                lda #1                  ; Track 1
                jsr check_hit
                bcc .no_x               ; No hit - no flash
                lda #10
                sta flash_t1_timer      ; Flash on hit!
.no_x:
                ; ... repeat for C and V
```

If `check_hit` succeeds (carry set):
1. The note is removed from play
2. The SID plays the note's sound
3. Score increases by 10 points
4. Hit zone flashes white

If `check_hit` fails (carry clear):
- Nothing happens (for now — we'll add miss handling in Unit 13)

## Build It. Run It.

```bash
acme -f cbm -o symphony.prg symphony.asm
x64sc symphony.prg
```

Watch the notes flow. When one enters the hit zone (the coloured block), press the matching key. You'll hear the note play and see the score increase!

Try hitting notes perfectly. Try missing them entirely. The game now has real gameplay — success and failure are distinguishable.

## What You've Learnt

- **Hit detection**: Search active notes for one matching track AND in hit zone
- **Carry flag results**: Set = success, clear = failure
- **SID voice mapping**: Three tracks → three voices → polyphonic sound
- **BCD scoring**: Decimal mode for easy score display

## The Complete Code

<CodeFromFile src="commodore-64/game-01-sid-symphony/unit-12/symphony.asm" />

## Next Unit

Hits feel great, but misses have no consequence. Notes just vanish off the left edge without penalty.

In Unit 13, we add miss detection — when notes leave the hit zone without being hit, something bad happens.
