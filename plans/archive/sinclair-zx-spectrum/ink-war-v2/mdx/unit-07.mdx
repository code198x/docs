---
title: "Claiming Cells"
description: "Press Space to claim territory. Track game state in memory. The battle begins."
pubDate: 2026-01-09
game: 1
gameName: "Ink War"
unit: 7
totalUnits: 64
system: "Sinclair ZX Spectrum"
tags: ["assembly", "z80", "game-state", "arrays", "claiming"]
prevLesson: "/sinclair-zx-spectrum/assembly/game-01-ink-war/unit-06"
nextLesson: "/sinclair-zx-spectrum/assembly/game-01-ink-war/unit-08"
layout: "../../../../layouts/UnitLayout.astro"
---

import CodeFromFile from "@components/CodeFromFile.astro";
import InlineNote from "../../../../components/units/InlineNote.astro";

## What You're Building

The cursor moves. Now it needs to do something. In this unit, pressing Space claims the current cell for the current player.

By the end of this unit, you'll have:

- A 64-byte array tracking board ownership
- Space key detection for claiming
- Validation (can't claim occupied cells)
- Visual and feedback for successful/failed claims

![Unit 7 Screenshot](/images/sinclair-zx-spectrum/game-01-ink-war/unit-07/screenshot.png)

*Press Space to claim the cell under the cursor!*

## Board State

Until now, we've only stored colours on screen. But a game needs to know who owns each cell — we need proper state tracking:

<CodeFromFile src="sinclair-zx-spectrum/game-01-ink-war/unit-07/snippets/01-board-state.asm" />

The `board_state` array has 64 bytes — one for each cell. We calculate the index using `row × 8 + column`.

<InlineNote>
Why track state separately from the display? The display can be redrawn, lost, or modified for visual effects. The board_state array is the authoritative record of who owns what.
</InlineNote>

## Claiming Logic

When Space is pressed, we:
1. Find the cell's position in the board_state array
2. Check if it's empty (value 0)
3. If empty, set it to the current player
4. Update the display

<CodeFromFile src="sinclair-zx-spectrum/game-01-ink-war/unit-07/snippets/02-check-claim.asm" />

The key validation: `or a` sets the zero flag if A is zero. If the cell isn't empty, we reject the claim.

## Updating the Display

After claiming, we update the screen to show the player's colour:

<CodeFromFile src="sinclair-zx-spectrum/game-01-ink-war/unit-07/snippets/03-update-display.asm" />

Now the display matches the game state. Red cells belong to Player 1, blue cells to Player 2.

## Feedback

Players need to know if their claim succeeded:

<CodeFromFile src="sinclair-zx-spectrum/game-01-ink-war/unit-07/snippets/04-feedback.asm" />

A green flash means success. A red flash means the cell was already taken. This simple feedback makes the game feel responsive.

## Cursor on Claimed Cells

One subtlety: the cursor needs to look different when over a claimed cell. We can't just draw yellow — that would hide whose territory it is.

The solution: when over a claimed cell, we add the FLASH bit to the existing colour. The cell blinks between showing colour and black, indicating both ownership and cursor position.

## Build It. Run It.

```bash
pasmonext --sna inkwar.asm inkwar.sna
```

Try these actions:

1. Move cursor to an empty cell → Press Space → Cell turns red (green flash)
2. Move cursor to another empty cell → Press Space → Cell turns red again
3. Try to claim the first cell again → Red flash (rejected!)

All cells belong to Player 1 for now — we'll add turn switching in Unit 8.

## What You've Learnt

- **Board state array**: 64 bytes tracking ownership
- **Index calculation**: row × 8 + column
- **Claim validation**: Check empty before allowing claim
- **State vs display**: Update both when claiming
- **Visual feedback**: Border flashes for success/failure

## The Complete Code

<CodeFromFile src="sinclair-zx-spectrum/game-01-ink-war/unit-07/inkwar.asm" />

## Next Unit

Right now, every claim goes to Player 1. That's not much of a game. In Unit 8, we'll add turn switching — after each successful claim, it becomes the other player's turn. Two players, one keyboard, real competition.
